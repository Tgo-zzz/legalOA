(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-628539ad"],{"3b3f":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r("d225"),i=r("bd86"),a=function e(){Object(n["a"])(this,e),Object(i["a"])(this,"rid",""),Object(i["a"])(this,"name",""),Object(i["a"])(this,"description",""),Object(i["a"])(this,"createBy","我"),Object(i["a"])(this,"updateBy",""),Object(i["a"])(this,"status",1),Object(i["a"])(this,"createTime",Date.now()),Object(i["a"])(this,"updateTime",Date.now()),Object(i["a"])(this,"permission",{})}},"7fb4":function(e,t,r){"use strict";var n=r("82e7"),i=r.n(n);i.a},"82e7":function(e,t,r){},8990:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-button",{attrs:{type:"primary"},on:{click:e.handleAddRole}},[e._v("添加新角色")]),e._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"30px"},attrs:{data:e.rolesList,border:""}},[r("el-table-column",{attrs:{align:"center",label:"#",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.$index+1))]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"角色",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.name))]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"创建者",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.createBy))]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"创建时间",sortable:"","sort-method":e.timeSorter,formatter:e.timeFormat,width:"180"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"状态",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(r){return e.handleStatusChange(t)}},model:{value:t.row.status,callback:function(r){e.$set(t.row,"status",r)},expression:"scope.row.status"}})]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"header-center",label:"描述"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.description))]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"操作",width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(r){return e.handleEdit(t)}}},[e._v("编辑")]),e._v(" "),r("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(r){return e.handleDelete(t)}}},[e._v("删除")])]}}])})],1),e._v(" "),r("el-dialog",{attrs:{visible:e.dialogVisible,title:"edit"===e.dialogType?"修改角色":"添加新角色"},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("el-form",{ref:"roleForm",attrs:{model:e.role,"label-width":"80px","label-position":"left",rules:e.formRoles}},[r("el-form-item",{attrs:{label:"名称",prop:"name"}},[r("el-input",{attrs:{placeholder:"角色名称"},model:{value:e.role.name,callback:function(t){e.$set(e.role,"name",t)},expression:"role.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"描述"}},[r("el-input",{attrs:{autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"角色描述"},model:{value:e.role.description,callback:function(t){e.$set(e.role,"description",t)},expression:"role.description"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"权限"}},[r("el-tree",{ref:"tree",staticClass:"permission-tree",attrs:{"check-strictly":!1,data:e.permissionsArray,props:e.defaultProps,"show-checkbox":"","node-key":"key"}})],1)],1),e._v(" "),r("div",{staticStyle:{"text-align":"right"}},[r("el-button",{attrs:{type:"danger"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.confirmRole}},[e._v("确认")])],1)],1)],1)},i=[],a=r("75fc"),s=(r("55dd"),r("96cf"),r("3b8d")),o=(r("7f7f"),r("2d63")),c=(r("df7c"),r("ed08")),l=r("3b3f"),u=r("d368"),d=(r("f3d6"),new l["a"]),h={data:function(){var e=this,t=function(t,r,n){var i,a=Object(o["a"])(e.rolesList);try{for(a.s();!(i=a.n()).done;){var s=i.value;if(s.name==r&&s.rid!=e.role.rid)return n("名字重复")}}catch(c){a.e(c)}finally{a.f()}return n()};return{loading:!1,permissions:{},defaultPermissions:{},rolesList:[],dialogVisible:!1,dialogType:"new",role:Object.assign({},d),defaultProps:{children:"children",label:"label"},formRoles:{name:[{required:!0,message:"名称不能为空",trigger:"blur"},{validator:t,trigger:"blur"}]}}},computed:{permissionsArray:function(){var e=Object(c["c"])(this.permissions),t=[];return this.childrenObjToArray(e,t),t},permissionsObject:function(){return Object(c["c"])(this.defaultPermissions)}},created:function(){this.initPermissions(),this.getRoles()},methods:{initPermissions:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(u["g"])();case 3:this.permissions=this.defaultPermissions=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e["catch"](0),console.log(e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])})));function t(){return e.apply(this,arguments)}return t}(),getRoles:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(u["h"])().then((function(e){return e.sort((function(e,t){return t.createTime-e.createTime}))}));case 3:this.rolesList=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e["catch"](0),console.log(e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])})));function t(){return e.apply(this,arguments)}return t}(),confirmRole:function(){var e=this;this.$refs["roleForm"].validate(function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(r){var n,i,s,o,c,l,d,h;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!r){t.next=26;break}if(n="edit"===e.dialogType,i=e.permissionsObject,e.setPermission(i,e.$refs.tree.getCheckedKeys()),e.role.permission=i,!n){t.next=18;break}return t.next=8,Object(u["k"])(e.role);case 8:s=0;case 9:if(!(s<e.rolesList.length)){t.next=16;break}if(e.rolesList[s].rid!==e.role.rid){t.next=13;break}return e.rolesList.splice(s,1,Object.assign({},e.role)),t.abrupt("break",16);case 13:s++,t.next=9;break;case 16:t.next=23;break;case 18:return t.next=20,Object(u["b"])(e.role,e.$store.getters.auth);case 20:o=t.sent,e.role.rid=o.rid,e.rolesList=[e.role].concat(Object(a["a"])(e.rolesList));case 23:c=e.role,l=c.description,d=c.rid,h=c.name,e.dialogVisible=!1,e.$notify({title:"Success",dangerouslyUseHTMLString:!0,message:"\n                <div>Key: ".concat(d,"</div>\n                <div>角色: ").concat(h,"</div>\n                <div>描述: ").concat(l,"</div>\n              "),type:"success"});case 26:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},handleStatusChange:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var r,n,i,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.row,n=r.rid,i=r.status,e.prev=3,this.loading=!0,e.next=7,Object(u["c"])(n,i);case 7:a=e.sent,s=0;case 9:if(!(s<this.rolesList.length)){e.next=15;break}if(this.rolesList[s].rid!==a.rid){e.next=12;break}return e.abrupt("break",15);case 12:s++,e.next=9;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e["catch"](3),r.status=r.status?0:1;case 20:return e.prev=20,this.loading=!1,e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[3,17,20,23]])})));function t(t){return e.apply(this,arguments)}return t}(),handleAddRole:function(){this.role=Object.assign({},d),this.$refs.tree&&this.$refs.tree.setCheckedNodes([]),this.dialogType="new",this.dialogVisible=!0},handleEdit:function(e){var t=this,r=Object(c["c"])(e.row),n=this.getPermissionsKey(r.permission);this.role=r,this.$refs.tree?this.$refs.tree.setCheckedKeys(n):this.$nextTick((function(){t.$refs.tree.setCheckedKeys(n)})),this.dialogType="edit",this.dialogVisible=!0},handleDelete:function(e){var t=this,r=e.$index,n=e.row;this.$confirm("确定要删除该角色吗?","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(u["e"])(n.rid);case 2:t.rolesList.splice(r,1),t.$message({type:"success",message:"删除成功!"});case 4:case"end":return e.stop()}}),e)})))).catch((function(e){console.error(e)}))},getPermissionsKey:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0;for(var n in e.on&&t.push(r||"root"),e.children)if(e.children.hasOwnProperty(n)){var i=e.children[n];this.getPermissionsKey(i,t,n)}return t},setPermission:function(e,t,r){for(var n in r||-1==t.indexOf("root")||(e.on=!0),r&&-1!=t.indexOf(r)&&(e.on=!0),e.children)if(e.children.hasOwnProperty(n)){var i=e.children[n];this.setPermission(i,t,n)}},childrenObjToArray:function(e,t,r){var n=e.children;for(var i in e.children=[],e.key=r||"root",e.label+=" ( ".concat(e.webRoute," , ").concat(e.httpRoute," ) "),n)if(n.hasOwnProperty(i)){var a=n[i];this.childrenObjToArray(a,e.children,i)}t.push(e)},timeSorter:function(e,t){return t.createTime-e.createTime},timeFormat:function(e){return Object(c["d"])(e.createTime)}}},f=h,b=(r("7fb4"),r("2877")),m=Object(b["a"])(f,n,i,!1,null,"c44091aa",null);t["default"]=m.exports},d368:function(e,t,r){"use strict";var n=r("75fc"),i=(r("7f7f"),r("b775")),a=(r("8c32"),r("3b3f")),s=r("d225"),o=r("bd86"),c=function e(){Object(s["a"])(this,e),Object(o["a"])(this,"did",""),Object(o["a"])(this,"name",""),Object(o["a"])(this,"leader",""),Object(o["a"])(this,"leaderMail",""),Object(o["a"])(this,"leaderPhone",""),Object(o["a"])(this,"superior","0"),Object(o["a"])(this,"status",0),Object(o["a"])(this,"grade",0),Object(o["a"])(this,"createTime",Date.now()),Object(o["a"])(this,"leaderRole",[]),Object(o["a"])(this,"memberRole",[]),Object(o["a"])(this,"subordinates",[]),Object(o["a"])(this,"updateInfo",[])};r.d(t,"g",(function(){return u})),r.d(t,"h",(function(){return d})),r.d(t,"b",(function(){return h})),r.d(t,"k",(function(){return f})),r.d(t,"c",(function(){return b})),r.d(t,"e",(function(){return m})),r.d(t,"f",(function(){return p})),r.d(t,"a",(function(){return v})),r.d(t,"j",(function(){return g})),r.d(t,"d",(function(){return O})),r.d(t,"i",(function(){return j}));var l="http://legal.tgozzz.cn/organization";function u(){return Object(i["a"])({baseURL:l,url:"/roles/permissions",method:"get"})}function d(){return Object(i["a"])({baseURL:l,url:"/roles",method:"get"})}function h(e,t){var r=Object.assign({name:"",description:"",createBy:"",updateBy:"",status:0,permission:{}},e);return r.createBy=t?t.name:"未知",Object(i["a"])({baseURL:l,url:"/roles",method:"post",data:r})}function f(e,t){var r=new a["a"];return Object.assign(r,e),r.updateTime=Date.now(),r.updateBy=t?t.name:"未知",Object(i["a"])({baseURL:l,url:"/roles/".concat(e.rid),method:"put",data:r})}function b(e,t){return Object(i["a"])({baseURL:l,url:"/roles/".concat(e,"?status=").concat(t),method:"patch"})}function m(e,t){return Object(i["a"])({baseURL:l,url:"/roles/".concat(e),method:"delete"})}function p(){return Object(i["a"])({baseURL:l,url:"/departments",method:"get"})}function v(e,t){var r=Object.assign({name:"0",leader:"0",leaderMail:"0",leaderPhone:"0",superior:"0",status:0,leaderRole:[],memberRole:[]},e);return Object(i["a"])({baseURL:l,url:"/departments",method:"post",data:r})}function g(e,t){var r=new c;return Object.assign(r,e),Object(i["a"])({baseURL:l,url:"/departments/".concat(r.did),method:"put",data:r})}function O(e,t){return Object(i["a"])({baseURL:l,url:"/departments/".concat(e),method:"delete"})}function j(e){return Object(i["a"])({baseURL:l,url:"/utils/permission/merge",method:"post",data:{roles:Object(n["a"])(e)}})}}}]);